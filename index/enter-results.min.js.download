$(document).ready(function(){function a(a){isiOS||($(a).focus(),$(a).select())}function b(a){$(a).css("background","#ffffaa"),$(a).prop("disabled",!1),$(a).css("opacity","1")}function c(a){$(a).css("background",""),$(a).prop("disabled",!0),$(a).css("opacity","0.5")}function d(a){$(a).css("background",""),$(a).prop("disabled",!1),$(a).css("opacity","1")}function e(){var a=!1;$('input[name^="input-answer"]').each(function(){""!=$(this).val()&&(a=!0)}),$("#save-progress").prop("disabled",!a)}function f(){""!=savedProgress?(msg="<button type='button' id='restore-progress' class='btn btn-default'><i class='fa fa-rotate-right'></i> Load</button>",msg+="<span class='text-muted small' style='padding: 0px 10px'>You have saved answers. Press Load to recover your saved answers, or Discard to clear them.</span>",msg+="<button type='button' id='clear-progress' class='btn btn-default'><i class='fa fa-trash-o'></i> Discard</button>",$("#restore-progress").prop("disabled",!1)):(msg="",$("#restore-progress").prop("disabled",!0)),$("#restore-progress-message").html(msg)}function g(a){$.ajax({type:"GET",url:"/ajax/students/getStudentPassingGrade",dataType:"json",success:function(b){h(a,b)},error:function(a){console.log("error",a)}})}function h(a,d){$.ajax({type:"POST",url:"/ajax/students/getLessonsInTopic",data:{menuId:menuId,tutorial:tutorial},success:function(e){var f=JSON.parse(e),g=$.grep(f,function(a){return parseInt(a.tutorial)==parseInt(tutorial)}),h="";if(void 0!==g[0]){var i=parseInt(g[0].lessonId),j=$.grep(f,function(a){return parseInt(a.lessonId)>i});nextTutorial=void 0!==j[0]?j[0].tutorial:g[0].tutorial;var k=parseInt(a.correct/(a.correct+a.incorrect)*100),l=null,m="";if(k>=d?(h="<p>Congratulations! You have successfully completed this lesson.</p>",void 0!==j[0]&&(m="Continue to next lesson ("+j[0].lessonCaption+")",l={label:m,className:"btn-continue-lesson btn-primary",callback:function(){bootbox.hideAll(),$("#worksheetResult").addClass("hidden"),createAndClickOnNextLesson(nextTutorial)}})):(l={label:"Try Again",className:"btn-try-again btn-default",callback:function(){bootbox.hideAll()}},h="<p>Keep trying. You may need to review the tutorial before attempting the questions again.</p>"),h+="<p>You scored "+k+"% ("+a.correct+" out of "+(a.correct+a.incorrect)+").</p>",a.grade<100){var n=a.results.split(","),o=!1;$("#tabWorksheet").find('input[name^="input-answer"]').each(function(a){"Y"==n[a]?c(this):(o||(o=!0),b(this))}),h+="<p>Your incorrect answers have been highlighted to aid further attempts.</p>"}h='<div style="padding: 20px 20px 0 20px;">'+h+"</div>",l?bootbox.dialog({message:h,buttons:{btnContinue:l,btnClose:{label:"Close",className:"btn-close",callback:function(){bootbox.hideAll()}}}}):bootbox.alert(h)}},error:function(a){console.log("error",a)}})}$("#bootstrap-modal div.modal-body"),$("#bootstrap-modal");$("#enter-results").fadeOut(0),e(),f(),$("#pin").click(function(){var a=$("#enter-results").css("position");"fixed"==a?($("#enter-results").css("position","relative"),$("#enter-results").css("bottom","auto"),$("html,body").animate({scrollTop:$("#enter-results").offset().top},"slow"),$("#pin").removeClass("active"),$("#pin").attr("title","Pin to the bottom of the screen")):($("#enter-results").css("position","fixed"),$("#enter-results").css("bottom","10px"),$("#pin").addClass("active"),$("#pin").attr("title","Restore to original position"))}),$("#enter-results-button").click(function(){return $("#enter-results").fadeToggle("slow",function(){$("#enter-results").is(":visible")&&$("#enter-results").find("*").filter(":input:visible:eq(1)").focus()}),!1}),$('input[name^="input-answer"]').keyup(function(b){if(e(),!(46==b.keyCode||8==b.keyCode||9==b.keyCode||27==b.keyCode||13==b.keyCode||229==b.keyCode||65==b.keyCode&&b.ctrlKey===!0||b.keyCode>=35&&b.keyCode<=39)){if(b.shiftKey||b.keyCode<65||b.keyCode>90)return void b.preventDefault();if(""!=$(this).val()){var c=$(this).parents("form:eq(0),body").find("input:not(:disabled)"),d=c.index(this);return d>-1&&d+1<c.length&&a(c.eq(d+1)),!1}}}),$('input[name^="input-answer"]').keydown(function(a){return 46==a.keyCode||8==a.keyCode||9==a.keyCode||27==a.keyCode||13==a.keyCode||229==a.keyCode||65==a.keyCode&&a.ctrlKey===!0||a.keyCode>=35&&a.keyCode<=39?void 0:a.shiftKey||a.keyCode<65||a.keyCode>90?void a.preventDefault():void 0}),$('input[name^="input-answer"]').focus(function(){return this.setSelectionRange(0,9999),!1}).mouseup(function(){return!1}),$("#enter-results-toolbar").on("click","#restore-progress",function(){if(""!=savedProgress){var a=savedProgress.split(",");$('input[name^="input-answer"]').each(function(b){""!=a[b]&&$(this).val(a[b])}),e()}}),$("#enter-results-toolbar").on("click","#clear-progress",function(){$.ajax({type:"POST",url:"/ajax/students/clearPartialAnswers",data:{tutorial:tutorial},dataType:"json",success:function(a){1==a.success?(savedProgress="",msg='<div style="padding: 20px;">Your progress has been cleared.</div>',bootbox.dialog({message:msg,buttons:{btnClose:{label:"Close",className:"btn-close",callback:function(){bootbox.hideAll()}}}}),f()):showSessionExpired()},error:function(){var a='<div style="padding: 20px;">There was an error clearing your progress. Please try again.</div>';bootbox.dialog({message:a,buttons:{btnClose:{label:"Close",className:"btn-close",callback:function(){bootbox.hideAll()}}}})}})}),$("#save-progress").click(function(){var a="",b=!1;$('input[name^="input-answer"]').each(function(c){""!=$(this).val()&&(b=!0),c>0&&(a+=","),a+=$(this).val()}),b&&(savedProgress=a,$.ajax({type:"POST",url:"/ajax/students/submitPartialAnswers",data:{answers:a,tutorial:tutorial,menuId:menuId},dataType:"json",success:function(a){1==a.success?(msg='<div style="padding: 20px;"><div>Your progress has been saved.</div><br /><div>Press the Load button to recover your answers at a later time.</div></div>',bootbox.dialog({message:msg,buttons:{btnClose:{label:"Close",className:"btn-close",callback:function(){bootbox.hideAll()}}}}),f()):showSessionExpired()},error:function(){var a='<div style="padding: 20px;">There was an error saving your progress. Please try again.</div>';bootbox.dialog({message:a,buttons:{btnClose:{label:"Close",className:"btn-close",callback:function(){bootbox.hideAll()}}}})}}))}),$("#submit-answers").click(function(){var b=$(this);b.attr("disabled",!0);var c="",e=!1;$("#tabWorksheet").find('input[name^="input-answer"]').each(function(d){return""==$(this).val()?(b.attr("disabled",!1),msg="<div style='padding: 20px;'><div>You must correctly fill in all boxes before submitting your answers for grading.</div><br /><div>Valid values are letters A to Z.</div></div>",bootbox.dialog({message:msg,buttons:{btnClose:{label:"Close",className:"btn-close",callback:function(){bootbox.hideAll()}}}}),a(this),e=!0,!1):(d>0&&(c+=","),void(c+=$(this).attr("data-qn")+":"+$(this).val()))}),e||$.ajax({type:"POST",url:"/ajax/students/submitAnswers",data:{answers:c,tutorial:tutorial,taskId:taskId,menuId:menuId},dataType:"json",success:function(a){1==a.success?(100==a.grade&&($('input[name^="input-answer"]').each(function(){$(this).val(""),d(this)}),$("#enter-results").fadeOut("slow")),0==tutorialHasWeeklyRevision&&g(a),tutorialHash=a.tutorialHash,canViewSolutions="true"===a.canViewSolutions?!0:!1,enableSolutionsLink(canViewSolutions),b.attr("disabled",!1)):showSessionExpired()},error:function(){var a='<div style="padding: 20px;">There was an error submitting your answers. Please try again.</div>';bootbox.dialog({message:a,buttons:{btnClose:{label:"Close",className:"btn-close",callback:function(){bootbox.hideAll()}}}}),b.attr("disabled",!1)}})})});