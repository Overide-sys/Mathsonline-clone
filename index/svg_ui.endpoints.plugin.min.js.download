"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,value:function(t){return 0<this.filter(function(e){return e==t}).length}}),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n){n=Object(n);for(var o=Object.keys(Object(n)),i=0,r=o.length;i<r;i++){var a=o[i],u=Object.getOwnPropertyDescriptor(n,a);void 0!==u&&u.enumerable&&(t[a]=n[a])}}}return t}}),function(d,l,i,o){var p,s="svgUI",n={checkAnswersClient:!1,DEBUG:!1,enableHints:!1,enableSupportVideo:!1,data:{},showPortraitMessage:!1,mode:"interactive",base_url:""};function t(e,t){this.element=e,this.question=null,this.userQuestionSetId=0,this.activeTutorial=0,this.activeTutorialMaster=0,this.preload=!0,this.initialQuestion=null,this.startTime=null,this.correctInARow=0,this.incorrectInARow=0,this.finalStat={type:"",completed:0,required:0},this.lastNextTimestamp=0,this.lastSubmitTimestamp=0,this.container=d(".svg-ui"),this.buttons={start:d("#ui__btn--start"),submit:d("#ui__btn--submit"),next:d("#ui__btn--next"),fullscreen:d("#ui__btn--fullscreen"),theme:d(".svg-ui__theme"),metadata:d("#ui__btn--metadata"),hints:d("#ui__btn--hint"),video:d("#ui__btn--video"),keypad:d("#ui__btn--keyboard"),debug:d("#ui__btn--debug"),result:d("#ui__btn--result"),restart:d("#ui__btn--restart"),retry:d("#ui__btn--retry"),nextLesson:d("#ui__btn--lesson")},this.panels={loader:d("#svg-ui__loader"),header:d(".svg-ui__header"),block:d(".svg-ui__block"),footer:d(".svg-ui__footer"),svg:d("#svg-ui__content"),metadata:d("#svg-ui__metadata"),debug:d("#svg-ui__debug"),error:{container:d("#svg-ui__error"),slot:d("#svg-ui__error--message")},result:d("#svg-ui__result_container"),welcome:d("#svg-ui__welcome"),completed:d("#svg-ui__completed"),result_message:d("#svg-ui__result_message"),result_progress:d("#svg-ui__result_progress"),progress:d(".svg-ui__header_progress"),percent:d(".svg-ui__header_percent"),correct:d(".svg-ui__header_correct")},this.labels={percent:d("#ui__label--percent"),completed:d("#ui__label--correct"),info:d("#ui__label--info"),result:d("#ui__label--result")},this.bars={progress:d("#ui__bar--progress"),result:d("#svg-ui__result_progressbar")},this.templates={question:{multi_part_current:function(e,t){return"<span>Part </span><strong>"+e+"</strong> of "+t},multi_part:function(e){return"<strong>"+e+"</strong> part question"},result:function(e,t,s){return"<h2>You scored <strong>"+Math.round(e)+'%</strong></h2>\n<div style="opacity: 0;"><strong>'+t+"</strong> correct out of "+s+" questions</div>"}},progress:{percent:function(e){return"<span>Score:</span> <strong>"+Math.round(e)+"%</strong>"},completed:function(e,t,s){return'<div class="hidden-xs"><span>Correct: </span> <strong>'+e+"</strong> of <strong>"+t+'</strong></div><div class="visible-xs"><strong>'+Math.round(s)+"%</strong> ( "+e+" of "+t+" )</div>"},position:function(e,t){return"<div>Question <strong>"+e+"</strong> of "+t+"</div>"}},orientation:{message:"You are in portrait mode. Switch to <strong>landscape</strong> for a better experience"},error:{default:'<i class="fa fa-exclamation-circle" aria-hidden="true"></i> An error occured performing operation',messages:{empty_set:'<i class="fa fa-info-circle" aria-hidden="true"></i> No question set returned from the server',network:'<i class="fa fa-info-circle" aria-hidden="true"></i> A network error occured while getting data from the server',asset:'<i class="fa fa-info-circle" aria-hidden="true"></i> Required asset is missing',fetch:'<i class="fa fa-info-circle" aria-hidden="true"></i> A network error occured while fetching asset from the server'}}},this.message={container:d("#svg-ui__notification"),slot:d("#svg-ui__message")},this.device={mobile:!1,portrait:!1,localStorageSupported:!1,stateStorageType:1},this.questions={currentIndex:0,correct:0,incorrect:0,partCorrect:0,total:0,percentCompleted:0,percentPart:0,percentResult:0,currentDifficulty:1,idsToIgnore:[],answered:[],marks:[],pointsRequired:0,pointsCompleted:0,worksheetQuestionCount:0,worksheetAnsweredCount:0},this.state={started:!1,submitted:!1,completed:!1,fullscreen:!1,keypadVisible:!1,panelMetadataVisible:!1,panelDebugVisible:!1,reconstructed:!1,restartCount:0},this.theme="default",this.options=d.extend({},n,t),this._defaults=n,this._name=s,this.init()}t.prototype.init=function(){(p=this).device.localStorageSupported=!!l.localStorage&&d.isFunction(localStorage.getItem)&&d.isFunction(localStorage.setItem)&&d.isFunction(localStorage.removeItem),1==p.options.reset&&(p.resetState(),p.panels.result.empty()),p.activeTutorialMaster=p.options.data.tutorialMaster,p.buttons.start.prop("disabled",!0),p.getSavedState(),p.detectDevice(),p.eventListeners(),p.bindEvents(),p.applyTheme(p.theme)},t.prototype.reStart=function(){p.userQuestionSetId=0,p.activeTutorial=0,p.preload=!0,p.initialQuestion=null,p.tryCount=0,p.questions={currentIndex:0,correct:0,incorrect:0,partCorrect:0,total:0,percentCompleted:0,percentPart:0,percentResult:0,currentDifficulty:1,idsToIgnore:[],marks:[],pointsRequired:0,pointsCompleted:0},p.state={started:!1,completed:!1,keypadVisible:!1,reconstructed:!1,submitted:!1,restartCount:0},p.saveState(),p.panels.error.container.hide(),p.panels.header.removeClass("visible"),p.panels.loader.removeClass("visible"),p.panels.svg.removeClass("visible").removeAttr("style"),p.panels.welcome.show(),p.panels.completed.removeClass("visible"),p.buttons.start.show().focus(),p.buttons.debug.hide(),p.buttons.metadata.hide(),p.panels.progress.css("opacity",1),p.panels.percent.css("opacity",1),p.panels.correct.css("opacity",0),p.panels.block.css("height","400px"),p.panels.welcome.css("z-index",1),p.panels.footer.show(),p.updateProgress(),p.start()},t.prototype.reTry=function(){p.panels.error.container.removeClass("visible"),p.start(),p.buttons.start.show(),p.panels.welcome.show()},t.prototype.applyTheme=function(e){var t;d.each(["svg-ui--theme-default","svg-ui--theme-dark","svg-ui--theme-mint","svg-ui--theme-material","svg-ui--theme-carbon","svg-ui--theme-drops"],function(e,t){p.container.removeClass(t)}),t="svg-ui--theme-"+(p.theme=e),p.container.toggleClass(t),p.saveState()},t.prototype.computeProgress=function(){switch(p.options.mode){case"worksheet":p.questions.percentCompleted=Math.round(p.questions.worksheetAnsweredCount/p.questions.worksheetQuestionCount*100);break;case"interactive":p.questions.percentCompleted=Math.round(p.questions.pointsCompleted/p.questions.pointsRequired*100)}100<p.questions.percentCompleted&&(p.questions.percentCompleted=100),p.bars.progress.css("width",p.questions.percentCompleted+"%"),0<p.questions.percentCompleted?p.bars.progress.show():p.bars.progress.hide()},t.prototype.updateProgress=function(){var e=0;0==p.state.submitted&&(0<p.questions.correct+p.questions.incorrect&&(e=p.questions.correct/(p.questions.correct+p.questions.incorrect)*100),p.labels.percent.html(p.templates.progress.percent(e)))},t.prototype.updateCorrect=function(){var e=0;0==p.state.submitted&&(0<p.questions.correct+p.questions.incorrect&&(e=p.questions.correct/(p.questions.correct+p.questions.incorrect)*100),p.labels.completed.html(p.templates.progress.completed(p.questions.correct,p.questions.correct+p.questions.incorrect,e)))},t.prototype.bindEvents=function(){p.buttons.start.on("click touchstart",function(e){e.preventDefault(),p.start()}),p.panels.svg.on("initialQuestionReady",function(e){d(this).hide(),p.panels.welcome.css("display","none"),p.state.started=!0,setTimeout(function(){p.startSet(!0)},500),p.device.portrait&&p.container.trigger("svg.ui.event",["orientation"])}),p.buttons.fullscreen.on("click touchstart",function(e){e.preventDefault(),p.state.fullscreen=!p.state.fullscreen,p.container.trigger("svg.ui.event",["state","toggle.fullscreen"])}),p.buttons.theme.on("click touchstart",function(e){e.preventDefault();var t=d(this).attr("data-theme");p.applyTheme(t)}),p.buttons.debug.on("click touchstart",function(e){e.preventDefault(),p.state.panelDebugVisible=!p.state.panelDebugVisible,p.container.trigger("svg.ui.event",["state","toggle.debug"])}),p.buttons.restart.on("click touchstart",function(e){e.preventDefault(),p.reStart()}),p.buttons.retry.on("click touchstart",function(e){e.preventDefault(),p.reTry()}),p.options.DEBUG&&p.buttons.metadata.on("click touchstart",function(e){e.preventDefault(),p.state.panelMetadataVisible=!p.state.panelMetadataVisible,p.container.trigger("svg.ui.event",["state","toggle.metadata"])})},t.prototype.eventListeners=function(){p.container.on("svg.ui.event",function(e,t,s){switch(t){case"orientation":p.options.showPortraitMessage&&p.showMessage("orientation",p.device.portrait);break;case"restart":p.reStart();break;case"state":switch(s){case"toggle.metadata":p.state.panelMetadataVisible?(p.buttons.metadata.addClass("btn-danger"),p.panels.metadata.show()):(p.buttons.metadata.removeClass("btn-danger"),p.panels.metadata.hide());break;case"toggle.debug":p.state.panelDebugVisible?(p.buttons.debug.addClass("btn-danger"),p.panels.debug.show()):(p.buttons.debug.removeClass("btn-danger"),p.panels.debug.hide());break;case"toggle.fullscreen":p.state.fullscreen?(p.buttons.fullscreen.addClass("btn-danger"),p.container.addClass("svg-ui--fullscreen"),d("body").css("position","fixed").css("width","100%")):(p.buttons.fullscreen.removeClass("btn-danger"),p.container.removeClass("svg-ui--fullscreen"),d("body").css("position","initial"));break;case"toggle.keypad":e.preventDefault(),p.state.keypadVisible?p.buttons.keypad.addClass("btn-danger"):p.buttons.keypad.removeClass("btn-danger");break;case"set.started":p.startSet(!0);break;case"set.completed":d("#svg-ui__result_toolbar").hide();var n=p.questions.correct/(p.questions.correct+p.questions.incorrect)*100;p.templates.question.result(n,p.questions.correct,p.questions.correct+p.questions.incorrect);p.panels.progress.css("opacity",0),p.panels.percent.css("opacity",0),p.panels.correct.css("opacity",0),p.state.panelDebugVisible=!1,p.state.panelMetadataVisible=!1,p.container.trigger("svg.ui.event",["state","toggle.metadata"]),p.container.trigger("svg.ui.event",["state","toggle.debug"]),p.panels.block.css("height","450px"),p.state.fullscreen&&(p.buttons.fullscreen.removeClass("btn-danger"),p.container.removeClass("svg-ui--fullscreen"),d("body").css("position","initial")),p.panels.completed.empty().append('<div id="svg_report__final" style="position: absolute; top:0; left: 0; right: 0; bottom: 0; display: flex; align-items:center; justify-content:center; font-size: 20px; background: #fff; text-align: center; color: #333;"><img src="/assets/images/loading.gif" /></div>'),p.panels.svg.removeClass("visible"),p.panels.completed.addClass("visible").css("z-index","700"),p.panels.footer.hide(),setTimeout(function(){d(i).trigger("svg.ui.generate",[p.userQuestionSetId,p.finalStat])},1e3)}p.saveState()}})},t.prototype.startSet=function(e){var t=p.initialQuestion;if("worksheet"==p.options.mode&&(p.state.completed=!1,p.saveState()),p.options.DEBUG&&p.state.started&&(p.buttons.metadata.show(),p.buttons.debug.show()),t){p.panels.loader.addClass("visible"),p.questions.correct=parseInt(t.correct),p.questions.incorrect=parseInt(t.incorrect),p.questions.pointsCompleted=parseInt(t.pointsCompleted),p.questions.pointsRequired=parseInt(t.pointsRequired),p.questions.worksheetQuestionCount=parseInt(t.worksheetQuestionCount),p.questions.worksheetAnsweredCount=parseInt(t.worksheetAnsweredCount),p.userQuestionSetId=parseInt(t.userQuestionSetId);var s=[];d.each(t.marks,function(e,t){s.push({correct:parseInt(t.correct),incorrect:parseInt(t.incorrect),difficulty:parseInt(t.difficulty)})}),p.questions.marks=s,p.getNextDifficulty(),p.computeProgress(),p.updateProgress(),p.updateCorrect(),p.panels.header.addClass("visible"),p.buttons.submit.show(),p.loadQuestion(t),p.userQuestionSetId=t.userQuestionSetId,p.panels.result.empty(),e&&p.saveState()}else p.showMessage("error",!0,p.templates.error.empty_set)},t.prototype.start=function(e){var t=p.startQuestionSet();p.buttons.start.hide(),p.panels.footer.hide(),t.then(function(e,t,s){if(void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),0==e)return p.panels.header.hide(),p.showMessage("error",!0,p.templates.error.default),void setTimeout(function(){p.panels.error.slot.html(p.templates.error.messages.empty_set),p.panels.error.container.addClass("visible")},300);p.panels.svg.trigger("initialQuestionReady"),p.buttons.start.show().focus(),p.questions.idsToIgnore=d.map(e.completedIds,function(e,t){return parseInt(e)}),p.initialQuestion=e,p.options.DEBUG&&p.state.started&&(p.buttons.metadata.show(),p.buttons.debug.show()),p.initialQuestion.svgInteractiveId&&!p.questions.idsToIgnore.includes(parseInt(p.initialQuestion.svgInteractiveId))&&p.questions.idsToIgnore.push(parseInt(p.initialQuestion.svgInteractiveId))},function(e,t,s){p.showMessage("error",!0,p.templates.error.default),setTimeout(function(){p.panels.error.slot.html(p.templates.error.messages.network),p.panels.error.container.addClass("visible")},300)})},t.prototype.getNextDifficulty=function(){var e=[],s=0,n=0;if(0<p.questions.marks.length){var o=0,i=0;e=(e=p.questions.marks).slice().reverse(),s=e[0].difficulty,d.each(e,function(e,t){(n++,t.difficulty==s&&n<=3)&&(0<t.correct||0<t.incorrect?50<=Math.round(t.correct/(t.correct+t.incorrect)*100)?(o++,i=0):(i++,o=0):i=o=0,3<=o||2==o&&1==s?s++:2<=i&&s--)})}else s=1;return s<1&&(s=1),4<s&&(s=4),p.questions.currentDifficulty=s},t.prototype.loadQuestion=function(a){JSON.stringify(a.interactive);var e=JSON.stringify(a.components),s=!1,t=!1,u={difficulty:1,correct:0,incorrect:0},n={isMobile:p.device.mobile,mode:"1",interactive:JSON.stringify(a.interactive),components:JSON.stringify(a.components),reconstruct:"",version:16,accent:a.accent,DEBUG:!0};d.each(JSON.parse(e),function(e,t){if(8==t.ComponentTypeID)return!(s=!0)}),p.options.enableSupportVideo&&(t=0<a.video.length),p.activeTutorial=a.activeTutorial,p.questions.total++,a.svgInteractiveId&&!p.questions.idsToIgnore.includes(parseInt(a.svgInteractiveId))&&p.questions.idsToIgnore.push(parseInt(a.svgInteractiveId)),p.questions.answered=a.completedIds,p.questions.partCorrect=0,p.panels.svg.hide(),p.parseMetadata(a.interactive),p.buttons.keypad.unbind("click"),p.buttons.next.unbind("click"),p.buttons.submit.unbind("click"),p.buttons.result.unbind("click"),p.buttons.next.hide(),s&&p.options.enableHints&&p.buttons.hints.unbind("click"),d("#ui__label--info").html("");var o=a.svg;if(0==o.length)return p.buttons.submit.hide(),p.showMessage("error",!0),void setTimeout(function(){p.panels.error.slot.html(p.templates.error.messages.asset),p.panels.error.container.addClass("visible")},300);var c=i.getElementById("svg-ui__content");c.innerHTML=o,requirejs(["app/app"],function(o){var i=!0,r=!1;u.correct=0,u.incorrect=0,p.buttons.next.attr("disabled","disabled"),p.buttons.submit.attr("disabled","disabled"),p.panels.debug.empty(),p.panels.svg.show(),o.EventManager.reset(),o.EventManager.subscribe(o.CONST.EVENT_QUESTION_LOADED,function(e){p.startTime=new Date,p.preload&&(p.panels.loader.removeClass("visible"),p.panels.header.addClass("visible"))}),o.EventManager.subscribe(o.CONST.EVENT_QUESTION_COMPLETED,function(e){o.G.$.keypadsContainer.find("[data-keyState='next']").text("Submit").css("visibility","hidden").css("pointer-events","none"),o.G.$.keypadsContainer.find("[data-keyState='submit']").text("Submit").css("visibility","hidden").css("pointer-events","none");var n=o.G.interactive.answers;p.state.submitted=!0,setTimeout(function(){p.state.submitted=!1,p.buttons.submit.unbind("click"),p.buttons.submit.attr("disabled","disabled"),p.buttons.submit.hide();var e=parseInt(new Date-p.startTime);u.difficulty=p.questions.currentDifficulty,p.questions.marks.push(u),p.saveState(),p.questions.percentPart=0,p.options.enableSupportVideo&&p.buttons.video.removeClass("visible");try{var t=JSON.stringify(n),s={userQuestionSetId:a.userQuestionSetId,svgInteractiveId:a.svgInteractiveId,tutorial:p.activeTutorial,correct:u.correct,incorrect:u.incorrect,duration:e,data:t,worksheetId:p.options.data.worksheetId,difficulty:p.questions.currentDifficulty};"[]"==t&&logError({severity:1,message:"Empty answer",userQuestionSetId:a.userQuestionSetId,svgInteractiveId:a.svgInteractiveId,tutorial:p.activeTutorial,worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId})}catch(e){logError({severity:1,message:"Empty answer",userQuestionSetId:a.userQuestionSetId,svgInteractiveId:a.svgInteractiveId,tutorial:p.activeTutorial,worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId,trace:JSON.stringify(e)})}s=Object.assign(s,p.options.data),i?p.saveAnswer(s).then(function(e,t,s){if(1==e.error)return p.reStart(),!1;switch(p.questions.pointsCompleted+=parseInt(a.interactive.Points),void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),p.questions.pointsRequired=parseInt(e.pointsRequired),p.questions.pointsCompleted=parseInt(e.pointsCompleted),p.questions.correct=parseInt(e.totalCorrect),p.questions.incorrect=parseInt(e.totalIncorrect),p.updateProgress(),p.updateCorrect(),p.computeProgress(),p.options.mode){case"interactive":r=p.questions.pointsCompleted>=p.questions.pointsRequired,p.finalStat={type:"interactive",completed:p.questions.pointsCompleted,required:p.questions.pointsRequired};break;case"worksheet":var n;n=parseInt(e.totalAnswered),p.finalStat={type:"worksheet",completed:n,required:a.worksheetQuestionCount},r=n>=a.worksheetQuestionCount}if(!p.state.completed)if(p.questions.currentIndex++,r){switch(p.options.mode){case"worksheet":p.questions.worksheetAnsweredCount=parseInt(e.totalAnswered)}p.updateCorrect(),p.updateProgress(),p.computeProgress(),p.state.completed=!0,p.buttons.submit.hide(),p.buttons.next.hide(),p.buttons.debug.hide(),p.buttons.metadata.hide(),p.buttons.keypad.hide(),o.destroyKeypad(),p.labels.info.empty(),setTimeout(function(){p.container.trigger("svg.ui.event",["state","set.completed"])},3e3)}else setTimeout(function(){p.buttons.next.removeAttr("disabled"),p.buttons.next.show().focus(),o.G.$.keypadsContainer.find("[data-keyState='next']").text("Next").css("visibility","visible").css("pointer-events","auto"),i=!1},1200);p.saveState()}):(p.buttons.next.removeAttr("disabled"),p.buttons.next.show().focus(),o.G.$.keypadsContainer.find("[data-keyState='next']").text("Next").css("visibility","visible").css("pointer-events","auto"),i=!1)},500)}),s&&p.options.enableHints&&(o.EventManager.subscribe(o.CONST.EVENT_HINT_AVAILABLE,function(){p.buttons.hints.addClass("visible")}),o.EventManager.subscribe(o.CONST.EVENT_HINT_NOT_AVAILABLE,function(){p.buttons.hints.removeClass("visible")})),o.EventManager.subscribe(o.CONST.EVENT_QUESTION_READY,function(){p.labels.info.empty(),p.buttons.next.hide(),p.buttons.keypad.removeClass("btn-danger"),p.buttons.submit.show(),p.buttons.submit.removeAttr("disabled"),1<o.G.interactive.questions.length&&p.labels.info.html(p.templates.question.multi_part_current(o.G.interactive.activeQuestion.id,o.G.interactive.questions.length)),p.state.keypadVisible="true"==o.G.$.keypadsContainer.attr("data-open"),p.state.keypadVisible&&p.state.mobile&&p.buttons.keypad.addClass("btn-danger"),t&&p.options.enableSupportVideo&&p.buttons.video.addClass("visible"),s&&p.options.enableHints&&p.buttons.hints.addClass("visible"),i=!0,o.G.$.keypadsContainer.find("[data-keyState='submit']").css("visibility","visible")}),o.EventManager.subscribe(o.CONST.EVENT_QUESTION_PART_COMPLETED,function(e){var t=JSON.parse(e);try{1<o.G.interactive.questions.length?t.correct?(u.correct++,p.questions.correct++):(u.incorrect++,p.questions.incorrect++):t.correct?(u.correct=1,u.incorrect=0,p.questions.correct++):(u.correct=0,u.incorrect=1,p.questions.incorrect++),p.updateCorrect(),p.updateProgress()}catch(e){}}),o.EventManager.subscribe(o.CONST.EVENT_LOG_DEBUG,function(e){var t=Date.now();p.panels.debug.append('<div class="'+t+' debug-entry">'+e+"</div>"),TweenMax.to(d(".debug-window ."+t),.5,{delay:3,color:"#aaaaaa"})}),o.EventManager.subscribe(o.CONST.EVENT_QUESTION_INCOMPLETE,function(e){i=!0,p.buttons.submit.removeAttr("disabled","disabled").show().focus()}),d("svg").attr("viewBox","0 0 820 450"),TweenMax.to("svg",1,{width:"100%",height:"100%"});try{o.init(c,n)}catch(e){p.reStart()}p.buttons.keypad.hide(),o.G.interactive.containsInputs&&p.device.mobile&&p.buttons.keypad.show(),p.labels.info.empty(),1<o.G.interactive.questions.length&&p.labels.info.html(p.templates.question.multi_part(o.G.interactive.questions.length)),p.buttons.next.bind("click",function(e){e.preventDefault();var t=Date.now();if(!(t-p.lastNextTimestamp<500)){p.lastNextTimestamp=t,d(this).unbind("click").hide();if(p.state.submitted=!1,p.state.completed)d(this).hide(),p.buttons.submit.hide();else{d("#ui__label--info").html('<div style="width: 25px; height: 25px; background: #fff; box-shadow: 0 2px 5px -2px rgba(0,0,0,0.1); border-radius: 5px; "><img src="/assets/images/progress-loader.gif" height="100%" width="100%" /></div>'),d(this).hide(),p.buttons.submit.attr("disabled","disabled").show();var s=1;switch(p.options.mode){case"interactive":s=p.getNextDifficulty(),p.questions.idsToIgnore.push(parseInt(a.svgInteractiveId));var n={userQuestionSetId:a.userQuestionSetId,tutorialMaster:p.activeTutorialMaster,difficulty:s,svgInteractiveIdsToIgnore:p.removeDuplicates(p.questions.idsToIgnore),worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId};n=Object.assign(n,p.options.data),d.when(p.getNextSVGInteractive(n)).then(function(e){if(void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),d.map(e.completedIds,function(e,t){e&&!p.questions.idsToIgnore.includes(parseInt(e))&&p.questions.idsToIgnore.push(parseInt(e))}),e.svgInteractiveId&&!p.questions.idsToIgnore.includes(parseInt(e.svgInteractiveId)))p.questions.idsToIgnore.push(parseInt(e.svgInteractiveId)),p.loadQuestion(e),parseInt(e.svgInteractiveId);else{var t={userQuestionSetId:a.userQuestionSetId,tutorialMaster:p.activeTutorialMaster,difficulty:s,svgInteractiveIdsToIgnore:p.removeDuplicates(p.questions.idsToIgnore),worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId};d.when(p.getNextSVGInteractive(t)).then(function(e){void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),p.questions.idsToIgnore=d.map(e.completedIds,function(e,t){return parseInt(e)}),p.questions.idsToIgnore.push(parseInt(e.svgInteractiveId)),p.loadQuestion(e),parseInt(e.svgInteractiveId)})}});break;case"worksheet":s=1;n={userQuestionSetId:a.userQuestionSetId,tutorialMaster:p.activeTutorialMaster,difficulty:s,worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId};n=Object.assign(n,p.options.data),d.when(p.getNextSVGInteractive(n)).then(function(e){void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),p.questions.worksheetQuestionCount=parseInt(e.worksheetQuestionCount),p.questions.worksheetAnsweredCount=parseInt(e.worksheetAnsweredCount),p.computeProgress(),p.loadQuestion(e),parseInt(e.svgInteractiveId)})}}}}),p.buttons.submit.bind("click",function(e){e.preventDefault(),p.buttons.submit.attr("disabled","disabled"),d.ajax({type:"POST",url:"/ajax/svg_interactives/saveMetadata",cache:!1,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},data:{tutorial:p.activeTutorial,userQuestionSetId:a.userQuestionSetId,svgInteractiveId:a.svgInteractiveId},success:function(e,t,s){if("OK"==s.getResponseHeader("Application-Status")&&1==i){p.questions.idsToIgnore.push(parseInt(a.svgInteractiveId));try{if(o.submit(),p.options.DEBUG)a.svgInteractiveId,a.userQuestionSetId}catch(e){p.logDebugError(e.message)}}},error:function(e,t,s){toastr.error("Could not save your answer at this time. Please try again."),p.buttons.submit.removeAttr("disabled")}})}),o.EventManager.subscribe(o.CONST.EVENT_SUBMIT,function(e){var n=Date.now();d.ajax({type:"POST",url:"/ajax/svg_interactives/saveMetadata",cache:!1,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},data:{tutorial:p.activeTutorial,userQuestionSetId:a.userQuestionSetId,svgInteractiveId:a.svgInteractiveId},success:function(e,t,s){if("OK"==s.getResponseHeader("Application-Status")){if(n-p.lastSubmitTimestamp<500)return;p.lastSubmitTimestamp=n}},error:function(e,t,s){toastr.error("Could not save your answer at this time. Please try again.")}})}),o.EventManager.subscribe(o.CONST.EVENT_NEXT_QUESTION,function(e){var t=Date.now();if(!(t-p.lastNextTimestamp<500)){p.lastNextTimestamp=t;var s=1;o.G.$.keypadsContainer.find("[data-keyState='next']").css("visibility","hidden");switch(p.options.mode){case"interactive":s=p.getNextDifficulty(),p.questions.idsToIgnore.push(parseInt(a.svgInteractiveId));var n={userQuestionSetId:a.userQuestionSetId,tutorialMaster:p.activeTutorialMaster,difficulty:s,svgInteractiveIdsToIgnore:p.removeDuplicates(p.questions.idsToIgnore),worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId};n=Object.assign(n,p.options.data),d.when(p.getNextSVGInteractive(n)).then(function(e){if(void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),d.map(e.completedIds,function(e,t){e&&!p.questions.idsToIgnore.includes(parseInt(e))&&p.questions.idsToIgnore.push(parseInt(e))}),e.svgInteractiveId&&!p.questions.idsToIgnore.includes(parseInt(e.svgInteractiveId)))p.questions.idsToIgnore.push(parseInt(e.svgInteractiveId)),p.loadQuestion(e),parseInt(e.svgInteractiveId);else{var t={userQuestionSetId:a.userQuestionSetId,tutorialMaster:p.activeTutorialMaster,difficulty:s,svgInteractiveIdsToIgnore:p.removeDuplicates(p.questions.idsToIgnore),worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId};d.when(p.getNextSVGInteractive(t)).then(function(e){void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),p.questions.idsToIgnore=d.map(e.completedIds,function(e,t){return parseInt(e)}),p.questions.idsToIgnore.push(parseInt(e.svgInteractiveId)),p.loadQuestion(e),parseInt(e.svgInteractiveId)})}});break;case"worksheet":s=1;n={userQuestionSetId:a.userQuestionSetId,tutorialMaster:p.activeTutorialMaster,difficulty:s,worksheetId:p.options.data.worksheetId,menuId:p.options.data.menuId};n=Object.assign(n,p.options.data),d.when(p.getNextSVGInteractive(n)).then(function(e){void 0!==e.sessionexpired&&1==e.sessionexpired&&(alert(e.errors),setTimeout(function(){l.location=p.options.base_url},300)),p.questions.worksheetQuestionCount=parseInt(e.worksheetQuestionCount),p.questions.worksheetAnsweredCount=parseInt(e.worksheetAnsweredCount),p.computeProgress(),p.loadQuestion(e)})}}});var e=0;o.G.interactive.activeQuestion&&o.G.interactive.activeQuestion.id&&(e=o.G.d3.questionsContainer.selectAll("[class=question"+o.G.interactive.activeQuestion.id+"] > [class^=input], [class=question"+o.G.interactive.activeQuestion.id+"] > [class*= input]").size()),p.device.mobile&&p.options.displayKeypad||p.isIpad()&&p.options.displayKeypad?(0==e&&o.openKeypad(o.CONST.KEYPAD_TYPE_NUMERIC),p.panels.footer.hide(),d('.toolbarKey[data-key="keypad-toggle"]').bind("click",function(e){p.state.keypadVisible="true"==o.G.$.keypadsContainer.attr("data-open"),p.state.keypadVisible?p.buttons.keypad.addClass("btn-danger"):p.buttons.keypad.removeClass("btn-danger")})):p.panels.footer.show(),p.buttons.keypad.bind("click",function(e){e.stopPropagation(),e.preventDefault(),p.state.keypadVisible="true"==o.G.$.keypadsContainer.attr("data-open"),p.state.keypadVisible?(o.closeKeypad(),d(this).removeClass("btn-danger")):"true"==d("#keypadsContainer").attr("data-open")?(o.closeKeypad(),d(this).removeClass("btn-danger")):(o.openKeypad(o.G.keypad.currentKeypad),d(this).addClass("btn-danger"))}),s&&p.options.enableHints&&p.buttons.hints.bind("click",function(e){e.preventDefault(),o.EventManager.publish(o.CONST.EVENT_HINT_DISPLAY)})})},t.prototype.showMessage=function(e,t){var s=2<arguments.length&&arguments[2]!==o?arguments[2]:"";switch(e){case"orientation":t&&p.state.started?(p.message.slot.html(p.templates.orientation.message),p.message.container.fadeIn(600),setTimeout(function(){p.message.container.fadeOut(300)},3e3)):p.message.container.hide();break;case"error":if(t){var n=0<s.length?s:p.templates.error.default;p.message.slot.html(n),p.message.container.addClass("error").fadeIn(600),setTimeout(function(){p.message.container.removeClass("error").fadeOut(300)},3e3)}else p.message.container.hide()}},t.prototype.parseMetadata=function(e){var s="";d.each(e,function(e,t){-1!=d.inArray(e.trim(),["TutorialMaster","SVGInteractiveID","Difficulty","Points","Duration","QuestionNumber"])&&(s+='<span class="badge badge-metadata"><span>'+e+"</span><strong>"+t+"</strong></span>&nbsp;")}),p.panels.metadata.html(s)},t.prototype.getSavedState=function(){var e={};p.theme=_typeof(store.get("svg_theme"))!=o?store.get("svg_theme"):"default";try{e=JSON.parse(store.get("svg_state"))}catch(e){}p.device.localStorageSupported?(p.state=d.extend(p.state,e),p.options.DEBUG&&p.state.started&&(p.buttons.metadata.show(),p.buttons.debug.show()),p.updateState()):d.when(p.getState()).then(function(e){var t=JSON.parse(e);p.state=d.extend(p.state,t.state),p.options.DEBUG&&p.state.started&&(p.buttons.metadata.show(),p.buttons.debug.show()),p.updateState()})},t.prototype.updateState=function(){switch(p.buttons.metadata.removeClass("btn-danger"),p.buttons.debug.removeClass("btn-danger"),p.buttons.fullscreen.removeClass("btn-danger"),p.options.DEBUG&&(p.state.panelDebugVisible&&(p.buttons.debug.addClass("btn-danger"),p.panels.debug.show()),p.state.panelMetadataVisible&&(p.buttons.metadata.addClass("btn-danger"),p.panels.metadata.show())),p.state.fullscreen?(p.buttons.fullscreen.addClass("btn-danger"),p.container.addClass("svg-ui--fullscreen"),d("body").css("position","fixed").css("width","100%")):d("body").css("position","initial").css("width","100%"),p.options.mode){case"interactive":p.state.completed?(p.panels.welcome.hide(),p.labels.result.html(p.templates.question.result(p.questions.correct/p.questions.total,p.questions.correct,p.questions.total)),p.panels.completed.addClass("visible"),p.buttons.debug.hide(),p.buttons.metadata.hide()):p.state.started&&!p.state.completed?(p.container.trigger("svg.ui.event",["app.state"]),p.container.trigger("svg.ui.event",["component.state"]),p.panels.welcome.hide(),p.startSet(!1)):p.buttons.start.focus();break;case"worksheet":p.container.trigger("svg.ui.event",["app.state"]),p.container.trigger("svg.ui.event",["component.state"])}},t.prototype.isMobileOrTablet=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||l.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|iPad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},t.prototype.isIpad=function(){var e=l.navigator.userAgent;if(-1<e.indexOf("iPad"))return!0;if(-1<e.indexOf("Macintosh"))try{return i.createEvent("TouchEvent"),!0}catch(e){}return!1},t.prototype.getBrowserWidth=function(){return l.innerWidth<768?"xs":l.innerWidth<991?"sm":l.innerWidth<1199?"md":"lg"},t.prototype.detectDevice=function(){p.getBrowserWidth();p.device.mobile=p.isMobileOrTablet()||p.isIpad(),l.addEventListener("orientationchange",function(){p.device.portrait=0==l.orientation,p.container.trigger("svg.ui.event",["orientation"])},!1),l.addEventListener("resize",function(){},!1);var e=l.matchMedia("(orientation: portrait)");p.device.portrait=e.matches&&p.device.mobile,p.device.portrait&&p.container.trigger("svg.ui.event",["orientation"]),e.addListener(function(e){p.getBrowserWidth(),p.device.mobile=p.isMobileOrTablet()||p.isIpad(),p.device.portrait=e.matches&&p.device.mobile,p.container.trigger("svg.ui.event",["orientation"])})},t.prototype.resetState=function(){p.device.localStorageSupported&&(p.questions.currentIndex=0,p.questions.percentCompleted=0,p.questions.percentPart=0,p.questions.correct=0,p.questions.total=0,p.state.completed=!1,p.state.started=!1,p.saveState())},t.prototype.saveState=function(){p.device.localStorageSupported&&(store.set("svg_theme",p.theme),store.set("svg_state",JSON.stringify(p.state)))},t.prototype.removeDuplicates=function(e){var t={};return e.forEach(function(e){t[e]||(t[e]=!0)}),Object.keys(t)},t.prototype.getState=function(){return d.ajax({type:"POST",url:"/dev/svg_ui/getState"})},t.prototype.saveAnswer=function(e){return p.options.DEBUG&&p.logDebugError("DEBUG - saveAnswer: "+JSON.stringify(e)),d.ajax({type:"POST",url:"/ajax/svg_interactives/submitResult?rid="+Math.random(),data:e,dataType:"json",cache:!1,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},error:function(e,t,s){0!=e.status&&(p.reStart(),toastr.error("Could not save your answer at this time. Please try again."))}})},t.prototype.startQuestionSet=function(){return p.options.DEBUG&&p.logDebugError("DEBUG - startQuestionSet: "+JSON.stringify(p.options.data)),d.ajax({type:"POST",url:"/ajax/svg_interactives/startQuestionSet?rid="+Math.random(),data:p.options.data,dataType:"json",timeout:2e4,tryCount:0,retryLimit:3,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},error:function(e,t,s){var n=this;setTimeout(function(){if(n.tryCount++,p.panels.error.container.addClass("visible"),n.tryCount<=n.retryLimit)var e=setInterval(function(){0<t?(p.panels.error.slot.html("Could not start your question at this time.<br />We will try again in "+t+" seconds."),p.buttons.retry.hide(),t--):(p.panels.error.slot.html('<i class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i> Connecting to server...'),clearInterval(e),d.ajax(n))},1e3),t=3;else setTimeout(function(){p.buttons.retry.show(),p.panels.error.slot.html(p.templates.error.messages.network),p.panels.error.container.addClass("visible")},300)},1e3)}})},t.prototype.getNextSVGInteractive=function(e){return e=Object.assign(e,p.options.data),p.options.DEBUG&&p.logDebugError("DEBUG - getNextSVGInteractive: "+JSON.stringify(e)),d.ajax({type:"POST",url:"/ajax/svg_interactives/getNextSvgInteractive?rid="+Math.random(),data:e,dataType:"json",tryCount:0,retryLimit:3,cache:!1,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},success:function(){0<this.tryCount&&p.reStart()},error:function(e,t,s){var n=this;setTimeout(function(){if(n.tryCount++,p.panels.error.container.addClass("visible"),n.tryCount<=n.retryLimit)var e=setInterval(function(){0<t?(p.panels.error.slot.html("Could not start your question at this time.<br />We will try again in "+t+" seconds."),p.buttons.retry.hide(),t--):(p.panels.error.slot.html('<i class="fa fa-circle-o-notch fa-spin" aria-hidden="true"></i> Connecting to server...'),clearInterval(e),d.ajax(n))},1e3),t=3;else setTimeout(function(){p.buttons.retry.show(),p.panels.error.slot.html(p.templates.error.messages.network),p.panels.error.container.addClass("visible")},300)},1e3)}})},t.prototype.logDebugError=function(e){d.ajax({type:"POST",url:"/ajax/svg_interactives/logDebugError",cache:!1,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},data:{message:e}}).done(function(e){})},t.prototype.getResultHeader=function(e){return e=Object.assign(e,p.options.data),d.ajax({type:"POST",url:"/ajax/svg_interactives/getSvgResultHeader",data:e,dataType:"json"})},d.fn[s]=function(e){return this.each(function(){d.data(this,"plugin_"+s)||d.data(this,"plugin_"+s,new t(this,e))})}}(jQuery,window,document);