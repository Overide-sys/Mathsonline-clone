!function(a){function b(d,e,f,g,i){5>g?a.ajax({type:"POST",url:"/ajax/interactives/submitInputAnswer",data:f,dataType:"json",success:function(b){if(1==b.success){v.previousResults.push(b);var c=b.results.split("|"),f=b.correctAnswers.split("|");k(c,f),v.currentQuestionId++,v.currentQuestionId<=v.numQuestions?(a("#button-submit-answer").removeAttr("disabled","disabled"),setTimeout(function(){h(v.currentQuestionId)},1200)):setTimeout(function(){d.find('[id^="question-"]').stop().stop().fadeIn("slow"),e(b)},100)}else 1==b.sessionexpired&&showSessionExpired()},error:function(a){i=a.responseText.length>0?a.responseText:"Network error",f.errorFunction="ajaxSubmitInputAnswer",f.retryCount=g,f.lastError=i,g>1?(setTimeout(function(){c(6)},1e3),setTimeout(function(){b(d,e,f,g+1,i)},6e3)):b(d,e,f,g+1,i)}}):setTimeout(function(){y.show()},1e3)}function c(a){a--,a>0?(x.show({html:"Awaiting network. Could not submit your answer at this time. Will try again in "+a+(a>1?" seconds.":" second.")}),setTimeout(function(){c(a)},1e3)):x.hide()}function d(){var b=v.questionContainer.find(".audio-tag");b.each(function(){var b=a(this),c=b.find('input[type="hidden"][name="audio-mp3"]'),d=b.find('input[type="hidden"][name="audio-ogg"]'),e=b.find(".audio-btn"),f=b.find(".audio-obj");f.jPlayer({ready:function(){a(this).jPlayer("setMedia",{mp3:c.val(),ogg:d.val()})},supplied:"mp3, ogg",solution:"html, flash",swfPath:"/assets/js/jplayer/"}),f.bind(a.jPlayer.event.play,function(){e.addClass("playing")}),f.bind(a.jPlayer.event.ended,function(){e.removeClass("playing")}),f.bind(a.jPlayer.event.pause,function(){e.removeClass("playing")}),e.click(function(){f.data("jPlayer").status.paused?f.jPlayer("play"):f.jPlayer("pause",0)})})}function e(){v.questionContainer.find(".selectable").click(function(){v.allowMultipleSelection||v.questionContainer.find("#question-"+v.currentQuestionId).find(".selectable").removeClass("active"),a(this).toggleClass("active")})}function f(){var b,c,d,e=1e3;v.questionContainer.find(".instances-container").each(function(){v.dropTargets.length>0&&a(this).addClass("drag-outline"),b=a(this),b.find("> span").reverse().each(function(){if(a(this).hasClass("scattered")?(d=Math.floor(Math.random()*(b.outerWidth()-a(this).outerWidth())),c=Math.floor(Math.random()*(b.outerHeight()-a(this).outerHeight()))):a(this).hasClass("stacked")?(d=0,c=0):(d=a(this).position().left,c=a(this).position().top),a(this).css({position:"absolute",top:c,left:d,margin:0,"touch-action":"none"}),a(this).hasClass("dragme")){a(this).find("img").css({padding:0});var f=a(this).hasClass("constrain")?b:null,g=(b[0].offsetTop,b[0].offsetLeft,b[0].clientTop,b[0].clientLeft,0),h=0,i=0,j=0;a(this).kendoDraggable({container:f,hint:function(b){var c=1;return a(b).parents().andSelf().each(function(){c*=a(this).css("opacity")||1}),a(b).css({opacity:c}),a(b).clone().css({opacity:c})},dragstart:function(b){a("#button-next-question").is(":visible")&&0==a("#button-next-question").is(":disabled")?b.preventDefault():(g=this.element[0].offsetLeft,h=this.element[0].offsetTop,i=this.hint[0].offsetLeft,j=this.hint[0].offsetTop,this.element.hide(),v.goodDrop=!1)},dragend:function(){0==v.dropTargets.length?(a(this.element).appendTo("body"),this.element.css({top:this.hint[0].offsetTop,left:this.hint[0].offsetLeft,"z-index":e++})):v.goodDrop||m(this.element.attr("data-graphicid")),this.element.show(),this.hint.hide()},dragcancel:function(){},drag:function(){}}),v.dropTargets.length>0&&a(this).click(function(b){if(a("#button-next-question").is(":visible")&&0==a("#button-next-question").is(":disabled"))b.preventDefault();else{var c=a(this);if(""!=a(this).attr("data-occupies"))m(a(this).attr("data-graphicid"));else{var d=!1;v.dropTargets.each(function(){1==v.dropTargets.length?l(c,a(this),!0):!d&&l(c,a(this),!1)&&(d=!0)})}}})}})})}function g(){v.questionContainer.find(".droptarget").kendoDropTarget({dragenter:function(b){a(b.dropTarget).addClass("active")},dragleave:function(b){a(b.dropTarget).removeClass("active")},drop:function(b){v.goodDrop=!0,l(a(b.draggable.currentTarget),a(b.dropTarget),!0)}})}function h(a){for(var b=1;b<=v.numQuestions;b++)b==a?v.questionContainer.find("#questions-container").find("#question-"+b).stop().fadeIn("slow"):(1==v.markingSequence||2==v.markingSequence&&b>a)&&v.questionContainer.find("#questions-container").find("#question-"+b).stop().fadeOut(0);t(v.questionContainer.find("#questions-container").find("#question-"+a))}function i(){v.questionContainer.find("span.crossout").each(function(){a(this).css({display:"inline-block",position:"relative",left:0,top:0});var b="";a(this).hasClass("crossout-large")&&(b=" crossout-overlay-large"),a(this).append("<span class='crossout-overlay"+b+"' style='width:"+a(this).outerWidth()+"px; height:"+a(this).outerHeight()+"px; '></span>");var c=a(this).children(".crossout-overlay");a(this).hover(function(){c.hasClass("selected")||c.fadeTo("fast",.5)},function(){c.hasClass("selected")||c.stop().fadeOut("fast")}),c.hover(function(){},function(){c.hasClass("selected")||c.stop().fadeOut("fast")}),c.click(function(){c.toggleClass("selected"),c.hasClass("selected")?c.fadeTo("fast",1):c.fadeTo("fast",0)})})}function j(){var b=v.questionContainer.find("#question-"+v.currentQuestionId),c=!0;if(0==v.dropTargets.length){var d=!0;return b.find('[name^="input-answer"]').each(function(){return u(a(this))&&!a(this).hasClass("ignore")?(c=!1,t(b),!1):void 0}),b.find(".selectable").length>0&&(d=b.find(".selectable.active").length>0),c&&d}return v.dropTargets.each(function(){return""==a(this).attr("data-occupants")?(c=!1,!1):void 0}),c}function k(a,b){for(var c=v.questionContainer.find("#question-"+v.currentQuestionId),d=!0,e=0,f=0,g=0;g<a.length;g++)"N"==a[g]?(f++,d=!1,q(c.find('[class^="mark-"]:eq('+g+")"),b[g])):"Y"==a[g]&&(e++,p(c.find('[class^="mark-"]:eq('+g+")")));d?r(c):s(c),v.noPartialMarks?d?v.correctCount++:v.incorrectCount++:(v.correctCount+=e,v.incorrectCount+=f)}function l(a,b,c){if(b.removeClass("active"),""!=b.attr("data-occupants")&&!b.hasClass("accept-multiple")){if(!c)return!1;m(b.attr("data-occupants"))}return b.append(a.css({top:(b.height()-a.height())/2,left:(b.width()-a.width())/2})),a.attr("data-occupies",b.attr("data-graphicid")),n(a,b),!0}function m(b){var c=v.questionContainer.find('[data-graphicid="'+b+'"]'),d=v.questionContainer.find('[data-containerid="'+b+'"]');d.append(c.css({top:0,left:0})),""!=c.attr("data-occupies")&&o(c,a('[data-graphicid="'+c.attr("data-occupies")+'"]')),c.attr("data-occupies","")}function n(b,c){v.dropTargets.each(function(){o(b,a(this))});var d=c.attr("data-occupants");""!=d?c.attr("data-occupants",d+","+b.attr("data-graphicid")):c.attr("data-occupants",b.attr("data-graphicid"))}function o(a,b){if(void 0!==b.attr("data-occupants")){for(var c=new Array,d=b.attr("data-occupants").split(","),e=0;e<d.length;e++)d[e]!=a.attr("data-graphicid")&&c.push(d[e]);b.attr("data-occupants",c.join(","))}}function p(a){a.find(".medium-tick").stop().fadeIn("slow")}function q(a,b){a.find(".medium-cross").stop().fadeIn("slow"),a.find(".correct-answer").html(b).stop().fadeIn("slow")}function r(a){a.find(".overall-mark > .medium-tick").stop().fadeIn("slow")}function s(a){a.find(".overall-mark > .medium-cross").stop().fadeIn("slow"),a.find(".solutions").stop().fadeIn("slow")}function t(b){var c=!1,d=[];return b.find('[name^="input-answer"]').each(function(){u(a(this))&&(c=!0,d.push(a(this).attr("tabindex")))}),c&&(d.sort(function(a,b){return a-b}),b.find("[tabindex="+d[0]+"]").focus()),c}function u(b){if(b.is("input")){if(""==a.trim(b.val()))return!0}else if(b.prop("selectedIndex")<0)return!0;return!1}var v={};a.fn.input=function(b){if(w[b])return w[b].apply(this,Array.prototype.slice.call(arguments,1));var c=typeof b;return"undefined"===c||"object"===c?w.init.apply(this,arguments):void a.error(b+" is not a method.")};var w={init:function(b){var c=a(this);v={},v.questionContainer=c,v.previousResults=[],v.allowMultipleSelection=b.allowMultipleSelection,v.markingSequence=b.markingSequence,v.autoTab=b.autoTab,v.noPartialMarks=b.noPartialMarks,v.numQuestions=c.find("#questions-container").find('[id^="question-"]').length,v.currentQuestionId=1,v.correctCount=0,v.incorrectCount=0,v.dropTargets=c.find("#questions-container").find(".droptarget"),v.draggables=c.find("#questions-container").find(".dragme"),v.goodDrop=!1,d(),e(),f(),g(),setTimeout(function(){i()},500),c.find("#questions-container").find('[name^="input-answer"]').each(function(){a(this).val(""),a(this).is("input")||a(this).prop("selectedIndex",-1),a(this).hasClass("digits")}),c.find(".noprint").each(function(){0==a(this).siblings().length&&a(this).parent().addClass("noprint")}),c.find(".medium-tick").stop().fadeOut(0),c.find(".medium-cross").stop().fadeOut(0),c.find(".correct-answer").stop().fadeOut(0),c.find(".solutions").stop().fadeOut(0),c.find(".crossout").removeClass("active"),c.find(".selectable").removeClass("active"),c.find('input[name^="input-answer"]').keypress(function(b){13==b.which&&(b.preventDefault(),a(this).blur(),a("#interactives-container").trigger("submit-answer"))}),v.autoTab&&c.find('input[name^="input-answer"]').keyup(function(b){if(!(46==b.keyCode||8==b.keyCode||9==b.keyCode||27==b.keyCode||13==b.keyCode||65==b.keyCode&&b.ctrlKey===!0||b.keyCode>=35&&b.keyCode<=39)&&""!=a(this).val()){var d=c.find("#question-"+v.currentQuestionId);return t(d),!1}}),h(v.currentQuestionId)},submit:function(c,d,e,f,g){var h=a(this),i=!1;if(j()){y.hide();var k=h.find("#questions-container #question-"+v.currentQuestionId);a(k).input("disable"),a("#button-submit-answer").attr("disabled","disabled");var l="",m="",n="",o=0;k.find('[name^="input-answer"]').each(function(b){b>0&&(l+="|"),o=u(a(this))?0:a(this).val(),a(this).is("select")&&a(this).find('[value="'+o+'"]').attr("selected",!0),l+=a(this).attr("data-inputid")+"=="+o});var p="";k.find(".selectable").each(function(b){b>0&&(m+="|"),p=a(this).hasClass("active")?"Y":"N",m+=a(this).attr("data-graphicid")+"=="+p}),v.draggables.each(function(b){b>0&&(n+="|"),n+=a(this).attr("data-graphicid")+"=="+a(this).attr("data-occupies")}),v.currentQuestionId==v.numQuestions&&a("#interactives-container").trigger("stop-timer"),iResubmit=0,lastError="",ajaxData={question:d,questionSet:c,id:v.currentQuestionId,answers:l,selectables:m,draggables:n,tutorial:tutorial,previousResults:v.previousResults,numQuestions:v.numQuestions,activeTutorial:e,duration:f},b(h,g,ajaxData,iResubmit,lastError)}return i},disable:function(){var b=a(this);b.find(":input").prop("disabled",!0),b.find(".selectable").unbind("click").css("cursor","default")},prepareToPrint:function(){var b=a(this);b.find(".audio-tag").stop().fadeOut(0),b.find(".noprint").stop().fadeOut(0),b.find(".crossout-overlay").stop().fadeOut(0),b.find(".replacement").stop().stop().fadeIn("slow"),a("body > span.dragme.noprint").remove()}},x=new a.peekABar({animation:{type:"fade",duration:1e3},cssClass:"custom-bar"}),y=new a.peekABar({animation:{type:"fade",duration:1e3},cssClass:"custom-bar",html:"Due to an unexpected network error your answer could not submitted at this time. Your progress has been saved. Please try again in a minute.",autohide:!0,delay:15e3,onShow:function(){a("#button-submit-answer").removeAttr("disabled")},onHide:function(){}})}(jQuery);